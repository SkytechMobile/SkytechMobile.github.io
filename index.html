<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Skytech Mobile 团队博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Skytech Mobile 团队博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Skytech Mobile 团队博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>Skytech Mobile 团队博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Skytech Mobile 团队博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/21/Subjects介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Skytech">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Skytech Mobile 团队博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/21/Subjects介绍/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-21T15:31:25+08:00">
                2020-04-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><p>Subjects 既是Observer，也是 Observable</p>
<ul>
<li>说它是Observer，是因为它能够动态地接收新的值。</li>
<li>说它又是一个 Observable，是因为当 Subjects 有了新的值之后，就会通过 Event 将新值发出给他的所有订阅者。<br>一共有五种 Subjects，分别为：<code>PublishSubject</code>、<code>BehaviorSubject</code>、<code>ReplaySubject</code>、<code>Variable</code>、<code>BehaviorRelay</code>。他们之间既有各自的特点，也有相同之处</li>
<li>首先他们都是Observable，他们的订阅者都能收到他们发出的新的 Event。</li>
<li>直到 Subject 发出 .complete 或者 .error 的 Event 后，该 Subject 便终结了，同时它也就不会再发出 .next 事件。</li>
<li>对于那些在 Subject 终结后再订阅他的订阅者，也能收到 subject 发出的一条 .complete 或 .error 的 event，告诉这个新的订阅者它已经终结了。</li>
<li>他们之间最大的区别只是在于：当一个新的订阅者刚订阅它的时候，能不能收到 Subject 以前发出过的旧 Event，如果能的话又能收到多少个。<br>Subject 常用的几个方法：</li>
<li>onNext(:)：是 on(.next(:)) 的简便写法。该方法相当于 subject 接收到一个 .next 事件。</li>
<li>onError(:)：是 on(.error(:)) 的简便写法。该方法相当于 subject 接收到一个 .error 事件。</li>
<li>onCompleted()：是 on(.completed) 的简便写法。该方法相当于 subject 接收到一个 .completed 事件。<h1 id="2-PublishSubject"><a href="#2-PublishSubject" class="headerlink" title="2. PublishSubject"></a>2. PublishSubject</h1><h2 id="2-1-简介"><a href="#2-1-简介" class="headerlink" title="2.1 简介"></a>2.1 简介</h2></li>
<li>PublishSubject 是最普通的 Subject，它不需要初始值就能创建。</li>
<li>PublishSubject 的订阅者从他们开始订阅的时间点起，可以收到订阅后 Subject 发出的新 Event，而不会收到他们在订阅前已发出的 Event。<h2 id="2-2-时序图"><a href="#2-2-时序图" class="headerlink" title="2.2 时序图"></a>2.2 时序图</h2><img src="http://reactivex.io/documentation/operators/images/S.PublishSubject.png" alt></li>
<li>最上面一条是 PublishSubject。</li>
<li>下面两条分别表示两个新的订阅，它们订阅的时间点不同，可以发现 PublishSubject 的订阅者只能收到他们订阅后的 Event。<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建一个PublishSubject</span></span><br><span class="line"><span class="keyword">let</span> subject = <span class="type">PublishSubject</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"> </span><br><span class="line"><span class="comment">//由于当前没有任何订阅者，所以这条信息不会输出到控制台</span></span><br><span class="line">subject.onNext(<span class="string">"111"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//第1次订阅subject</span></span><br><span class="line">subject.subscribe(onNext: &#123; string <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第1次订阅："</span>, string)</span><br><span class="line">&#125;, onCompleted:&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第1次订阅：onCompleted"</span>)</span><br><span class="line">&#125;).disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//当前有1个订阅，则该信息会输出到控制台</span></span><br><span class="line">subject.onNext(<span class="string">"222"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//第2次订阅subject</span></span><br><span class="line">subject.subscribe(onNext: &#123; string <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第2次订阅："</span>, string)</span><br><span class="line">&#125;, onCompleted:&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第2次订阅：onCompleted"</span>)</span><br><span class="line">&#125;).disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//当前有2个订阅，则该信息会输出到控制台</span></span><br><span class="line">subject.onNext(<span class="string">"333"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//让subject结束</span></span><br><span class="line">subject.onCompleted()</span><br><span class="line"> </span><br><span class="line"><span class="comment">//subject完成后会发出.next事件了。</span></span><br><span class="line">subject.onNext(<span class="string">"444"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//subject完成后它的所有订阅（包括结束后的订阅），都能收到subject的.completed事件，</span></span><br><span class="line">subject.subscribe(onNext: &#123; string <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第3次订阅："</span>, string)</span><br><span class="line">&#125;, onCompleted:&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第3次订阅：onCompleted"</span>)</span><br><span class="line">&#125;).disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="3-BehaviorSubject"><a href="#3-BehaviorSubject" class="headerlink" title="3. BehaviorSubject"></a>3. BehaviorSubject</h1><h2 id="3-1-简介"><a href="#3-1-简介" class="headerlink" title="3.1 简介"></a>3.1 简介</h2><ul>
<li>BehaviorSubject 需要通过一个默认初始值来创建。</li>
<li>当一个订阅者来订阅它的时候，这个订阅者会立即收到 BehaviorSubjects 上一个发出的 event。之后就跟正常的情况一样，它也会接收到 BehaviorSubject 之后发出的新的 event。<h2 id="3-2-时序图"><a href="#3-2-时序图" class="headerlink" title="3.2 时序图"></a>3.2 时序图</h2><img src="http://reactivex.io/documentation/operators/images/S.BehaviorSubject.png" alt></li>
<li>最上面一条是 BehaviorSubject。</li>
<li>下面两条分别表示两个新的订阅，它们订阅的时间点不同，可以发现 BehaviorSubject 的订阅者一开始就能收到 BehaviorSubjects 之前发出的一个 Event。<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建一个BehaviorSubject</span></span><br><span class="line"><span class="keyword">let</span> subject = <span class="type">BehaviorSubject</span>(value: <span class="string">"111"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//第1次订阅subject</span></span><br><span class="line">subject.subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第1次订阅："</span>, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//发送next事件</span></span><br><span class="line">subject.onNext(<span class="string">"222"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//发送error事件</span></span><br><span class="line">subject.onError(<span class="type">NSError</span>(domain: <span class="string">"local"</span>, code: <span class="number">0</span>, userInfo: <span class="literal">nil</span>))</span><br><span class="line"> </span><br><span class="line"><span class="comment">//第2次订阅subject</span></span><br><span class="line">subject.subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第2次订阅："</span>, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="4-ReplaySubject"><a href="#4-ReplaySubject" class="headerlink" title="4. ReplaySubject"></a>4. ReplaySubject</h1><h2 id="4-1-简介"><a href="#4-1-简介" class="headerlink" title="4.1 简介"></a>4.1 简介</h2><ul>
<li>ReplaySubject 在创建时候需要设置一个 bufferSize，表示它对于它发送过的 event 的缓存个数。</li>
<li>比如一个 ReplaySubject 的 bufferSize 设置为 2，它发出了 3 个 .next 的 event，那么它会将后两个（最近的两个）event 给缓存起来。此时如果有一个 subscriber 订阅了这个 ReplaySubject，那么这个 subscriber 就会立即收到前面缓存的两个 .next 的 event。</li>
<li>如果一个 subscriber 订阅已经结束的 ReplaySubject，除了会收到缓存的 .next 的 event 外，还会收到那个终结的 .error 或者 .complete 的 event。<h2 id="4-2-时序图"><a href="#4-2-时序图" class="headerlink" title="4.2 时序图"></a>4.2 时序图</h2><img src="http://reactivex.io/documentation/operators/images/S.ReplaySubject.png" alt></li>
<li>最上面一条是 ReplaySubject（bufferSize 设为为 2）。</li>
<li>下面两条分别表示两个新的订阅，它们订阅的时间点不同。可以发现 ReplaySubject 的订阅者一开始就能收到 ReplaySubject 之前发出的两个 Event（如果有的话）。<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line"> </span><br><span class="line"><span class="comment">//创建一个bufferSize为2的ReplaySubject</span></span><br><span class="line"><span class="keyword">let</span> subject = <span class="type">ReplaySubject</span>&lt;<span class="type">String</span>&gt;.create(bufferSize: <span class="number">2</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//连续发送3个next事件</span></span><br><span class="line">subject.onNext(<span class="string">"111"</span>)</span><br><span class="line">subject.onNext(<span class="string">"222"</span>)</span><br><span class="line">subject.onNext(<span class="string">"333"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//第1次订阅subject</span></span><br><span class="line">subject.subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第1次订阅："</span>, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//再发送1个next事件</span></span><br><span class="line">subject.onNext(<span class="string">"444"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//第2次订阅subject</span></span><br><span class="line">subject.subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第2次订阅："</span>, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//让subject结束</span></span><br><span class="line">subject.onCompleted()</span><br><span class="line"> </span><br><span class="line"><span class="comment">//第3次订阅subject</span></span><br><span class="line">subject.subscribe &#123; event <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"第3次订阅："</span>, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="5-Variable-废弃"><a href="#5-Variable-废弃" class="headerlink" title="5. Variable(废弃)"></a>5. Variable(废弃)</h1><h2 id="5-1-简介"><a href="#5-1-简介" class="headerlink" title="5.1 简介"></a>5.1 简介</h2><ul>
<li>Variable 其实就是对 BehaviorSubject 的封装，所以它也必须要通过一个默认的初始值进行创建。</li>
<li>Variable 具有 BehaviorSubject 的功能，能够向它的订阅者发出上一个 event 以及之后新创建的 event。</li>
<li>不同的是，Variable 还把会把当前发出的值保存为自己的状态。同时它会在销毁时自动发送 .complete 的 event，不需要也不能手动给 Variables 发送 completed 或者 error 事件来结束它。</li>
<li>简单地说就是 Variable 有一个 value 属性，我们改变这个 value 属性的值就相当于调用一般 Subjects 的 onNext() 方法，而这个最新的 onNext() 的值就被保存在 value 属性里了，直到我们再次修改它。</li>
</ul>
<p><code>注意：Variables 本身没有 subscribe() 方法，但是所有 Subjects 都有一个 asObservable() 方法。我们可以使用这个方法返回这个 Variable 的 Observable 类型，拿到这个Observable 类型我们就能订阅它了。</code></p>
<h2 id="5-2-时序图"><a href="#5-2-时序图" class="headerlink" title="5.2 时序图"></a>5.2 时序图</h2><p><img src="http://reactivex.io/documentation/operators/images/S.AsyncSubject.png" alt></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> RxSwift</span><br><span class="line"><span class="keyword">import</span> RxCocoa</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//创建一个初始值为111的Variable</span></span><br><span class="line">        <span class="keyword">let</span> variable = <span class="type">Variable</span>(<span class="string">"111"</span>)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//修改value值</span></span><br><span class="line">        variable.value = <span class="string">"222"</span></span><br><span class="line">         </span><br><span class="line">        <span class="comment">//第1次订阅</span></span><br><span class="line">        variable.asObservable().subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"第1次订阅："</span>, $<span class="number">0</span>)</span><br><span class="line">        &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//修改value值</span></span><br><span class="line">        variable.value = <span class="string">"333"</span></span><br><span class="line">         </span><br><span class="line">        <span class="comment">//第2次订阅</span></span><br><span class="line">        variable.asObservable().subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"第2次订阅："</span>, $<span class="number">0</span>)</span><br><span class="line">        &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//修改value值</span></span><br><span class="line">        variable.value = <span class="string">"444"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>注意：由于 Variable 对象在 viewDidLoad() 方法内初始化，所以它的生命周期就被限制在该方法内。当这个方法执行完毕后，这个 Variable 对象就会被销毁，同时它也就自动地向它的所有订阅者发出 .completed 事件</code></p>
<h1 id="5-BehaviorRelay"><a href="#5-BehaviorRelay" class="headerlink" title="5. BehaviorRelay"></a>5. BehaviorRelay</h1><h2 id="5-1-简介-1"><a href="#5-1-简介-1" class="headerlink" title="5.1 简介"></a>5.1 简介</h2><ul>
<li>BehaviorRelay 是作为 Variable 的替代者出现的。它的本质其实也是对 BehaviorSubject 的封装，所以它也必须要通过一个默认的初始值进行创建。</li>
<li>BehaviorRelay 具有 BehaviorSubject 的功能，能够向它的订阅者发出上一个 event 以及之后新创建的 event。</li>
<li>与 BehaviorSubject 不同的是，不需要也不能手动给 BehaviorReply 发送 completed 或者 error 事件来结束它（BehaviorRelay 会在销毁时也不会自动发送 .complete 的 event）。</li>
<li>BehaviorRelay 有一个 value 属性，我们通过这个属性可以获取最新值。而通过它的 accept() 方法可以对值进行修改。<br>上面的 Variable 样例我们可以改用成 BehaviorRelay<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> RxSwift</span><br><span class="line"><span class="keyword">import</span> RxCocoa</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//创建一个初始值为111的BehaviorRelay</span></span><br><span class="line">        <span class="keyword">let</span> subject = <span class="type">BehaviorRelay</span>&lt;<span class="type">String</span>&gt;(value: <span class="string">"111"</span>)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//修改value值</span></span><br><span class="line">        subject.accept(<span class="string">"222"</span>)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//第1次订阅</span></span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"第1次订阅："</span>, $<span class="number">0</span>)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//修改value值</span></span><br><span class="line">        subject.accept(<span class="string">"333"</span>)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//第2次订阅</span></span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"第2次订阅："</span>, $<span class="number">0</span>)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//修改value值</span></span><br><span class="line">        subject.accept(<span class="string">"444"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>如果想将新值合并到原值上，可以通过 accept() 方法与 value 属性配合来实现。（这个常用在表格上拉加载功能上，BehaviorRelay 用来保存所有加载到的数据）</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> RxSwift</span><br><span class="line"><span class="keyword">import</span> RxCocoa</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">let</span> disposeBag = <span class="type">DisposeBag</span>()</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//创建一个初始值为包含一个元素的数组的BehaviorRelay</span></span><br><span class="line">        <span class="keyword">let</span> subject = <span class="type">BehaviorRelay</span>&lt;[<span class="type">String</span>]&gt;(value: [<span class="string">"1"</span>])</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//修改value值</span></span><br><span class="line">        subject.accept(subject.value + [<span class="string">"2"</span>, <span class="string">"3"</span>])</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//第1次订阅</span></span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"第1次订阅："</span>, $<span class="number">0</span>)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//修改value值</span></span><br><span class="line">        subject.accept(subject.value + [<span class="string">"4"</span>, <span class="string">"5"</span>])</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//第2次订阅</span></span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"第2次订阅："</span>, $<span class="number">0</span>)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//修改value值</span></span><br><span class="line">        subject.accept(subject.value + [<span class="string">"6"</span>, <span class="string">"7"</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/17/Viper架构探索实践（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Skytech">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Skytech Mobile 团队博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/17/Viper架构探索实践（一）/" itemprop="url">Viper架构探索实践（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-17T19:35:00+08:00">
                2019-10-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/作者：Fan-Chason/" itemprop="url" rel="index">
                    <span itemprop="name">作者：Fan Chason</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Viper架构图"><a href="#Viper架构图" class="headerlink" title="Viper架构图"></a>Viper架构图</h1><p><img src="http://upload-images.jianshu.io/upload_images/1432381-6aa65d17f5ed033f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/1432381-0b5691a0070fbabd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1865432-580872920986b640.png"></p>
<h2 id="VIPER的主要部分"><a href="#VIPER的主要部分" class="headerlink" title="VIPER的主要部分"></a>VIPER的主要部分</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul>
<li>View: (视图）： 显示Presenter告知的内容，并将用户输入中继回Presenter。</li>
<li>Interactor: (交互器）：包含用例指定的业务逻辑。</li>
<li>Presenter: (表示层，也可称主持人）：包含用于准备显示内容（如从Interactor接收的）和用于对用户输入做出反应（通过从Interactor请求新数据）的视图逻辑。</li>
<li>Entity: (实体）：包含Interactor使用的基本模型对象。</li>
<li>Routing: (路由）：包含用于描述按哪个顺序显示哪些屏幕的导航逻辑。</li>
</ul>
<blockquote>
<p>这种分离也符合<a href="http://www.objectmentor.com/resources/articles/srp.pdf" target="_blank" rel="noopener">单一责任原则</a>。<br>Interactor负责业务分析师<br>Presenter代表交互设计师<br>View负责视觉设计师</p>
</blockquote>
<h3 id="相比MVX"><a href="#相比MVX" class="headerlink" title="相比MVX"></a>相比MVX</h3><p>相比之前的MVX架构，VIPER多出了两个东西：Interactor（交互器）和Router（路由）。</p>
<p>各部分职责如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- View</span><br><span class="line">提供完整的视图，负责视图的组合、布局、更新</span><br><span class="line">向Presenter提供更新视图的接口</span><br><span class="line">将View相关的事件发送给Presenter</span><br><span class="line"></span><br><span class="line">- Presenter</span><br><span class="line">接收并处理来自View的事件</span><br><span class="line">向Interactor请求调用业务逻辑</span><br><span class="line">向Interactor提供View中的数据</span><br><span class="line">接收并处理来自Interactor的数据回调事件</span><br><span class="line">通知View进行更新操作</span><br><span class="line">通过Router跳转到其他View</span><br><span class="line"></span><br><span class="line">- Router</span><br><span class="line">提供View之间的跳转功能，减少了模块间的耦合</span><br><span class="line">初始化VIPER的各个模块</span><br><span class="line"></span><br><span class="line">- Interactor</span><br><span class="line">维护主要的业务逻辑功能，向Presenter提供现有的业务用例</span><br><span class="line">维护、获取、更新Entity</span><br><span class="line">当有业务相关的事件发生时，处理事件，并通知Presenter</span><br><span class="line"></span><br><span class="line">- Entity</span><br><span class="line">和Model一样的数据模型</span><br></pre></td></tr></table></figure>

<h1 id="Viper模版代码生成工具"><a href="#Viper模版代码生成工具" class="headerlink" title="Viper模版代码生成工具"></a>Viper模版代码生成工具</h1><h2 id="推荐两个模版"><a href="#推荐两个模版" class="headerlink" title="推荐两个模版"></a>推荐两个模版</h2><h3 id="Viperit"><a href="#Viperit" class="headerlink" title="Viperit"></a><a href="https://github.com/ferranabello/Viperit" target="_blank" rel="noopener">Viperit</a></h3><ul>
<li>支持Swift、SwiftUI</li>
<li>可创建viper架构模版</li>
</ul>
<h3 id="Generamba"><a href="#Generamba" class="headerlink" title="Generamba"></a><a href="https://github.com/strongself/Generamba" target="_blank" rel="noopener">Generamba</a></h3><ul>
<li>支持OC和Swift</li>
<li>可以创建mvvm、viper模版</li>
</ul>
<h2 id="了解模版语言Liquid"><a href="#了解模版语言Liquid" class="headerlink" title="了解模版语言Liquid"></a>了解模版语言Liquid</h2><p>github源码：<strong><a href="https://github.com/Shopify/liquid" target="_blank" rel="noopener">liquid</a></strong><br><a href="https://www.baidu.com/link?url=fK4IqIz8Jd_NwiiLfMbodfFYy5521QApXPJBhxB5yD_ACOge0kdPzMlm5_3B_tT9&wd=&eqid=df8a26640004378f000000045a6a8ac1" target="_blank" rel="noopener"><em>Liquid</em> 模板语言中文文档</a></p>
<blockquote>
<p>Liquid 是一门开源的模板语言，由 <a href="https://www.shopify.com/" target="_blank" rel="noopener">Shopify</a> 创造并用 Ruby 实现。它是 Shopify 主题的骨骼，并且被用于加载店铺系统的动态内容。<br><br>从 2006 年起，Liquid 就被 Shopify 所使用，现在更是被大量 web 应用所使用</p>
</blockquote>
<h1 id="Viper架构实践"><a href="#Viper架构实践" class="headerlink" title="Viper架构实践"></a>Viper架构实践</h1><p>基于Viperit写了一个简单的新闻的demo<br><strong><a href="https://github.com/FanChason/XCViperitDemo" target="_blank" rel="noopener">XCViperitDemo</a></strong></p>
<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ol>
<li>viper原作者 By <a href="mailto:jeff.gilbert@mutualmobile.com" target="_blank" rel="noopener">Jeff Gilbert</a> and <a href="https://twitter.com/conradstoll" target="_blank" rel="noopener">Conrad Stoll</a> 著<br><a href="https://www.objc.io/issues/13-architecture/viper/" target="_blank" rel="noopener">Architecting iOS Apps with VIPER</a></li>
<li><a href="https://juejin.im/post/599a43035188252432172045" target="_blank" rel="noopener">iOS VIPER架构实践(二)：VIPER详解与实现</a></li>
<li><a href="https://www.jianshu.com/p/340b39c6d256" target="_blank" rel="noopener">iOS架构模式-VIPER</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/11/使用fastlane实现iOS自动化打包上传fir-im和testflight/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Skytech">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Skytech Mobile 团队博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/11/使用fastlane实现iOS自动化打包上传fir-im和testflight/" itemprop="url">使用fastlane实现iOS自动化打包上传fir.im和testflight</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-11T16:41:33+08:00">
                2019-10-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/作者：Fan-Chason/" itemprop="url" rel="index">
                    <span itemprop="name">作者：Fan Chason</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><em>日复一日重复打包工作，是在浪费宝贵的时间</em></p>
<p><em>自动化打包工具应运而生，是我们解放双手的利器</em></p>
<p><a href="https://docs.fastlane.tools/" target="_blank" rel="noopener">fastlane官方文档</a></p>
<p><a href="https://github.com/fastlane/fastlane/tree/master/fastlane/docs#fastfile" target="_blank" rel="noopener">github地址</a></p>
<h2 id="安装fastlane"><a href="#安装fastlane" class="headerlink" title="安装fastlane"></a>安装fastlane</h2><h3 id="安装最新的Xcode命令行工具"><a href="#安装最新的Xcode命令行工具" class="headerlink" title="安装最新的Xcode命令行工具"></a>安装最新的Xcode命令行工具</h3><blockquote>
<p>可以<a href="https://developer.apple.com/download/more/" target="_blank" rel="noopener">Developer Apple</a>上手动下载对应的<code>Command Line Tools</code> 安装</p>
</blockquote>
<p><em>fastlane官方推荐的<code>xcode-select --install</code> 安装时最后结果是*</em>不能安装该软件***</p>
<h3 id="安装-fastlane"><a href="#安装-fastlane" class="headerlink" title="安装 fastlane"></a>安装 fastlane</h3><p><em>放到<code>/usr/local/bin</code>下面</em></p>
<p><code>sudo gem install -n /usr/local/bin fastlane</code></p>
<p>其他的安装方法：（扩展，可跳过）</p>
<p><img src="1970838-d07d8f2b55853319.png" alt></p>
<blockquote>
<p>第一种是通过 Homebrew 软件包管理器来进行安装，<br>第二种就是我们最熟悉的方式，下载安装包来进行安装,<br>第三种是通过 RubyGems 来进行，RubyGems 是一个方便的 Ruby 程序包管理器，可以将一个 Ruby 应用程序打包到一个 Gem 里，作为一个安装单元。 一个  Gem 就是一个封装起来的应用程序或代码库</p>
</blockquote>
<h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><p>添加用户环境变量 </p>
<p><code>vim ~/.bash_profile</code></p>
<p>添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">export PATH=/usr/local/bin:$PATH</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>保存退出，使用 <code>source ~/.bash_profile</code> 来使配置立即生效</p>
<p>现在在项目根目录下可以使用<code>fastlane</code>了</p>
<h2 id="fastlane使用"><a href="#fastlane使用" class="headerlink" title="fastlane使用"></a>fastlane使用</h2><h3 id="在项目根目录下初始化"><a href="#在项目根目录下初始化" class="headerlink" title="在项目根目录下初始化"></a>在项目根目录下初始化</h3><p><code>fastlane init</code></p>
<ul>
<li><p>四个选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">What would you like to use fastlane for?</span><br><span class="line"></span><br><span class="line">1.Automate screenshots</span><br><span class="line">2.Automate beta distribution to TestFlight</span><br><span class="line">3.Automate App Store distribution</span><br><span class="line">4.Manual setup - manually setup your project to automate your tasks</span><br></pre></td></tr></table></figure>

<p>解释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 自动截屏。（帮助我们截取App的显示到appstore上的 截图）</span><br><span class="line">2 自动发布beta到TestFlight上，用于内测。</span><br><span class="line">3 自动打包发布到AppStore上。</span><br><span class="line">4 手动设置。</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>  上传fir选择的4</p>
<ul>
<li>初始化成功会生成如下目录</li>
</ul>
<p><img src="Xnip2019-10-09_14-40-37.jpg" alt></p>
<h3 id="配置相关文件"><a href="#配置相关文件" class="headerlink" title="配置相关文件"></a>配置相关文件</h3><h4 id="配置Gemfile"><a href="#配置Gemfile" class="headerlink" title="配置Gemfile"></a>配置Gemfile</h4><p>如果使用cocoapods要加上（<em>注意带上当前安装的pod的版本号</em>，否则会报错）</p>
<p><code>gem &#39;cocoapods&#39;, &#39;~&gt;1.8.3&#39;</code> </p>
<p>执行 </p>
<p><code>bundle install</code></p>
<blockquote>
<p>第一次运行 bundle install 时自动生成 Gemfile.lock 文件。以后每次运行 bundle install 时,如果 Gemfile 中的条目不变 bundle 就不会再次计算 gem 依赖版本号，直接根据 Gemfile.lock 检查和安装 gem。如果出现依赖冲突时可以通过 bundle update 更新 Gemfile.lock</p>
</blockquote>
<h4 id="配置Fastfile"><a href="#配置Fastfile" class="headerlink" title="配置Fastfile"></a>配置Fastfile</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">default_platform(<span class="symbol">:ios</span>)</span><br><span class="line"></span><br><span class="line">platform <span class="symbol">:ios</span> <span class="keyword">do</span></span><br><span class="line">  </span><br><span class="line">  	before_all <span class="keyword">do</span></span><br><span class="line">    	<span class="comment"># 如果你用 pod install</span></span><br><span class="line">    	cocoapods </span><br><span class="line">  	<span class="keyword">end</span></span><br><span class="line">  </span><br><span class="line">  	desc <span class="string">"打包上传ipa到fir.im"</span></span><br><span class="line">  	lane <span class="symbol">:fir</span> <span class="keyword">do</span></span><br><span class="line">    </span><br><span class="line">  	<span class="comment"># 如果你没有申请adhoc证书，sigh会自动帮你申请，并且添加到Xcode里</span></span><br><span class="line">  	<span class="comment">#	sigh(adhoc: true)</span></span><br><span class="line">      </span><br><span class="line">  	<span class="comment"># 以下两个action来自fastlane-plugin-versioning，</span></span><br><span class="line">  	<span class="comment"># 第一个递增 Build，第二个设定Version。</span></span><br><span class="line">  	<span class="comment"># 如果你有多个target，就必须指定target的值，否则它会直接找找到的第一个plist修改</span></span><br><span class="line">  	<span class="comment"># 在这里我建议每一个打的包的Build都要不一样，这样crash了拿到日志，可以对应到ipa上</span></span><br><span class="line">  </span><br><span class="line">    increment_build_number_in_plist(</span><br><span class="line">        <span class="symbol">target:</span> <span class="string">'TestDemo'</span>,</span><br><span class="line"> 				<span class="symbol">build_number:</span> <span class="string">'5'</span></span><br><span class="line">    )</span><br><span class="line">    increment_version_number_in_plist(</span><br><span class="line">        <span class="symbol">target:</span> <span class="string">'TestDemo'</span>,</span><br><span class="line">        <span class="symbol">version_number:</span> <span class="string">'1.0'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># gym用来编译ipa</span></span><br><span class="line">    gym(</span><br><span class="line">        <span class="symbol">scheme:</span> <span class="string">'TestDemo'</span>,</span><br><span class="line">        <span class="symbol">export_method:</span> <span class="string">"ad-hoc"</span>, <span class="comment"># 指定打包方式 ["app-store", "ad-hoc", "package", "enterprise", "development", "developer-id"]</span></span><br><span class="line">        <span class="comment">#teamID: "xxxxxx",  # developer.apple.com 上查看</span></span><br><span class="line">        <span class="symbol">xcargs:</span> <span class="string">"-allowProvisioningUpdates"</span>,</span><br><span class="line">        <span class="symbol">output_directory:</span> <span class="string">'./firim'</span>,</span><br><span class="line">        <span class="symbol">output_name:</span> <span class="string">'TestDemo.ipa'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 上传ipa到fir.im服务器，在fir.im获取firim_api_token</span></span><br><span class="line">    firim(<span class="symbol">firim_api_token:</span> <span class="string">"xxxxxxxxxxxxx"</span>)  <span class="comment"># token 在fir 上查看。</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  </span><br><span class="line">  desc <span class="string">"打包上传testflight/app-store"</span></span><br><span class="line">  lane <span class="symbol">:tf</span> <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">    increment_build_number_in_plist(</span><br><span class="line">        <span class="symbol">target:</span> <span class="string">'TestDemo'</span></span><br><span class="line">    )</span><br><span class="line">    increment_version_number_in_plist(</span><br><span class="line">        <span class="symbol">target:</span> <span class="string">'TestDemo'</span>,</span><br><span class="line">        <span class="symbol">version_number:</span> <span class="string">'1.0'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># gym用来编译ipa</span></span><br><span class="line">    gym(</span><br><span class="line">        <span class="symbol">scheme:</span> <span class="string">'TestDemo'</span>,</span><br><span class="line">        <span class="symbol">export_method:</span> <span class="string">"app-store"</span>, <span class="comment"># 指定打包方式</span></span><br><span class="line">        <span class="comment">#teamID: "xxxxxx",  # developer.apple.com 上查看</span></span><br><span class="line">        <span class="symbol">xcargs:</span> <span class="string">"-allowProvisioningUpdates"</span>,</span><br><span class="line">        <span class="symbol">output_directory:</span> <span class="string">'./testflight'</span>,</span><br><span class="line">        <span class="symbol">output_name:</span> <span class="string">'TestDemo.ipa'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">#upload_to_testflight</span></span><br><span class="line">    appstore       <span class="comment"># 上传你的App iTunes Connect</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于build_number与version_number</p>
<p>1,version_number、build_number都没有设置，会自动获取项目的version和build版本号，并且都自动加1。例如，fastlane打包前后版本号变化：ver1.0.2（Build 11）-&gt; ver1.0.3（Build 12）；<br>2,version_number设置了、build_number没设置，会自动获取项目build版本号，build版本号+1；<br>3,version_number、build_number都设置了，那打包出来的版本号就是设置的版本号，不会自动+1；</p>
</blockquote>
<h4 id="添加两个插件"><a href="#添加两个插件" class="headerlink" title="添加两个插件"></a>添加两个插件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fastlane add_plugin versioning</span><br><span class="line">fastlane add_plugin firim</span><br></pre></td></tr></table></figure>

<h3 id="执行打包"><a href="#执行打包" class="headerlink" title="执行打包"></a>执行打包</h3><h4 id="上传fir-im"><a href="#上传fir-im" class="headerlink" title="上传fir.im"></a>上传fir.im</h4><p><code>fastlane fir</code></p>
<blockquote>
<p><code>fir</code>为Fastfile文件中<code>lane :fir do</code>处设置的名字，可以为别的名字</p>
</blockquote>
<p>执行打包成功如下图所示：</p>
<img src="Xnip2019-10-10_15-01-27.jpg" style="zoom:5%">

<ul>
<li><p>根目录下<code>firim</code>文件夹下可看到<code>ipa</code>文件</p>
<p><img src="Xnip2019-10-10_15-22-43.jpg" alt></p>
</li>
<li><p>fir.im应用列表，多了刚上传的项目</p>
<p><img src="Xnip2019-10-10_15-01-59.jpg" alt></p>
</li>
</ul>
<h4 id="上传testFlight"><a href="#上传testFlight" class="headerlink" title="上传testFlight"></a>上传testFlight</h4><p><code>fastlane tf</code></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>Could not find action, lane or variable ‘increment_build_number_in_plist’…</li>
</ol>
<p><img src="Xnip2019-10-10_11-39-52.jpg" alt></p>
<ul>
<li><p>解决：</p>
<p><code>fastlane add_plugin versioning</code></p>
</li>
</ul>
<p>参考：<a href="https://github.com/SiarheiFedartsou/fastlane-plugin-versioning/issues/20" target="_blank" rel="noopener">https://github.com/SiarheiFedartsou/fastlane-plugin-versioning/issues/20</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="https://www.jianshu.com/p/2918cf082b9d" target="_blank" rel="noopener">fastlane 自动打包到 fir.im 的踩坑之路</a></li>
<li><a href="https://docs.fastlane.tools/getting-started/ios/setup/" target="_blank" rel="noopener">fastlane ios快读入门文档</a></li>
<li><a href="https://www.jianshu.com/p/19ae8cc865b0" target="_blank" rel="noopener">fastlane使用说明书</a></li>
<li><a href="https://www.jianshu.com/p/48343a655f75" target="_blank" rel="noopener">fastlane 在mac上配置iOS自动化上架</a></li>
<li><a href="https://www.jianshu.com/p/eab3e1ded17d" target="_blank" rel="noopener">iOS 自动打包 - fastlane （一）</a></li>
<li><a href="https://juejin.im/post/5a7d51986fb9a063435ece35" target="_blank" rel="noopener">和重复劳动说再见-使用fastlane进行iOS打包</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/25976099" target="_blank" rel="noopener">macOS/Linux 环境变量设置</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/26/基于Hexo和Github搭建技术博客/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Skytech">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Skytech Mobile 团队博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/26/基于Hexo和Github搭建技术博客/" itemprop="url">基于Hexo和Github搭建技术博客</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-26T14:40:33+08:00">
                2019-09-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/作者：Fan-Chason/" itemprop="url" rel="index">
                    <span itemprop="name">作者：Fan Chason</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="准备"><a href="#准备" class="headerlink" title="准备:"></a>准备:</h2><p><code>nodejs</code>、<code>git</code>、<code>npm</code>、<code>hexo</code></p>
<p>验证有没有敲命令，eg: <code>npm -v</code>，没有装先去装</p>
<ul>
<li><p>npm可通过homebrew安装</p>
<p><code>brew install npm</code> </p>
</li>
<li><p>Hexo安装</p>
<p><code>npm install hexo-cli -g</code></p>
</li>
</ul>
<h2 id="开始搭建博客"><a href="#开始搭建博客" class="headerlink" title="开始搭建博客"></a>开始搭建博客</h2><ul>
<li><p>本地创建一个存放博客文件夹</p>
<p>eg: SkytechMobileBlog</p>
</li>
<li><p>切到<code>SkytechMobileBlog</code>目录下执行<code>初始化</code></p>
<p><code>hexo init</code></p>
</li>
<li><p>然后安装依赖</p>
<p><code>npm install</code></p>
</li>
<li><p>生成静态文件</p>
<p><code>hexo g</code></p>
</li>
<li><p>创建服务</p>
<p><code>hexo s</code></p>
</li>
<li><p>hexo常用命令：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>hexo init</code></td>
<td>初始化一个文件夹，它会为这个文件夹配置所有骨架</td>
</tr>
<tr>
<td><code>hexo g</code></td>
<td>即hexo generate，生成静态文件</td>
</tr>
<tr>
<td><code>hexo s</code></td>
<td>即hexo server，创建服务</td>
</tr>
<tr>
<td><code>hexo d</code></td>
<td>即hexo deploy,用于将本地文件发布到github上</td>
</tr>
<tr>
<td><code>hexo n</code></td>
<td>即hexo new,用于新建一篇文章</td>
</tr>
</tbody></table>
<p>现在只是在本地搭建了一个技术博客，</p>
<p>要想把博客内容让所有人都能看到，就得借助Github了，把博客内容部署到Github上去</p>
</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/09/26/基于Hexo和Github搭建技术博客/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/26/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Skytech">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Skytech Mobile 团队博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/26/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-26T13:53:03+08:00">
                2019-09-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Skytech</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Skytech</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
